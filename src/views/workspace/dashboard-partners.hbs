<div class="Admin-container" id="statePartners">

  {{> messages}}
  <fieldset class="Admin-fieldset">
    <legend class="Admin-legend colorPartner" id="lengedAdmin">
      <span class="Admin-span">Partner Dashboard</span>
      {{#if loggedIn}}
      <div class="Admin-Username">
        <span class="Admin-Username-greeting">Hi, Welcome </span>
        <span id="tipName" class="Admin-Username-name">{{userName}}</span>
      </div>
      {{/if}}
    </legend>
    {{> partners }}
  </fieldset>
</div>

<script>
  //EDITAR
  function edit(id_partner) {
    opcion = 'edit';
    const idPartner = id_partner;
    const url = `http://localhost:3000/api/partners/${idPartner}`;
    fetch(url)
      .then((response) => response.json())
      .then((datos) => {
        $("#id_partner").val(datos.id_partner);
        $("#dni").val(datos.dni);
        $("#name").val(datos.name);
        $("#lastname").val(datos.lastname);
        $("#direction").val(datos.direction);
        $("#population").val(datos.population);
        $("#phone1").val(datos.phone1);
        $("#phone2").val(datos.phone2);
        $("#email").val(datos.email);
        $(".modal-header").css("background-color", "#7303c0");
        $(".modal-header").css("color", "white");
        $(".modal-title").text("Edit PARTNER");
      })
      .then((result) => {
        console.log(result)
      })
  }

  //DELETE
  function deletePartner(id_partner) {
    opcion = 'delete';
    const idPartner = id_partner;
    Swal.fire({
      title: 'Are you sure?',
      text: "Are you sure you want to delete the PARTNER!",
      icon: 'warning',
      showConfirmButton: true,
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    })
      .then((result) => {
        console.log(result)
        if (result.isConfirmed) {
          console.log('ES YES')
          Swal.fire(
            'Deleted! Book ' + idPartner,
            'Your book has been deleted.',
            'success',
            window.location = `http://localhost:3000/api/partners/delete/${idPartner}`
          );
        }
      });
  }

  //MOSTRAR
  $(document).ready(function (e) {
    const url = 'http://localhost:3000/api/partners/';

    $('#example').DataTable({
      "ajax": {
        "url": url,
        "dataSrc": ""
      },
      'searching': true,
      'ordering': true,
      'info': true,
      'responsive': true,
      "order": [[0, "desc"]],
      "lengthMenu": [[5, 10, 15, 25, 50, -1], [5, 10, 15, 25, 50, "All"]],
      "pageLength": 15,
      'deferRender': true,
      columns: [
        { data: 'id_partner', 'visible': false },
        { data: 'dni' },
        { data: 'name' },
        { data: 'lastname' },
        { data: 'phone1' },
        { data: 'phone2' },
        { data: 'email' },
        {
          data: null,
          render: function (data, type) {
            return `
                      <div class="ui buttons">
                        <button id="btnEditPartner" onClick=edit(`+ data.id_partner + `) type="button"  class="btn btn-outline-info" data-toggle="modal" data-target="#modalPARTNER" href="#edit" title="Edit book"><i class="fa-regular fa-pen-to-square"></i></button>
                        <div class="or" data-text="or">                          
                        </div>
                        <button id="btnDeletePartner" onClick=deletePartner(`+ data.id_partner + `) class="btn btn-outline-danger" title="Delete book"><i class="fa-solid fa-trash-can"></i></button>
                      </div>
                      `
          }
        }
      ]
      //para a√±adir decimales a un numero
      /* "columnDefs": [{
         "targets": [7],
         render(v) {
           return Number(v).toFixed(2)
         }
       }]*/
    });
  });

  //UPDATE
  $('#formu').submit(function (e) {
    e.preventDefault();
    id_partner = $.trim($('#id_partner').val());
    dni = $.trim($('#dni').val());
    name = $.trim($('#name').val());
    lastname = $.trim($('#lastname').val());
    direction = $.trim($('#direction').val());
    population = $.trim($('#population').val());
    phone1 = $.trim($('#phone1').val());
    phone2 = $.trim($('#phone2').val());
    email = $.trim($('#email').val());
    url = `http://localhost:3000/api/partners/update/${id_partner}`
    if (opcion === 'edit') {
      fetch(url, {
        method: 'POST',
        body: JSON.stringify({
          id_partner: id_partner,
          dni: dni,
          name: name,
          lastname: lastname,
          direction: direction,
          population: population,
          phone1: phone1,
          phone2: phone2,
          email: email
        }),
      headers: {
          "Content-type": "application/json; charset=UTF-8"
      }
      });
    }
    location.reload(true);
    $('#modalPARTNER').hide();
  });
</script>